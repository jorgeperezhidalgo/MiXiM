\chapter{PRUEBAS}\label{cap:pru}
La realización de pruebas y el análisis de resultados se ha llevado a cabo durante todas las fases del proyecto a partir de la fase de diseño. En la sección \ref{sec:pru1} encontramos las pruebas más relevantes realizadas a los circuitos y los montajes parciales del robot. En la sección \ref{sec:pru2} podemos ver la pruebas realizadas al robot completo.

\section{\bfseries MONTAJES INTERMEDIOS}\label{sec:pru1}
La pruebas de montajes intermedios se han ido realizando a lo largo del desarrollo del proyecto, para confirmar el correcto funcionamiento de las distintas partes, y simplificar así el proceso de integración de las mismas.

\subsection{CONFIGURACIÓN Y CONTROL DE INTERFAZ HUMANA}
Las pruebas de configuración y control de la interfaz humana se realizaron satisfactoriamente en la placa de desarrollo diseñada con el PIC16F876\footnote{Desarrollo previo \ref{subsec:16F} página \pageref{subsec:16F}.}. Las pruebas realizadas consisten en mostrar mensajes por la pantalla LCD e introducir caracteres por teclado en código ASCII hexadecimal para visualizarlos por pantalla.

\subsection{PUERTO SERIE RS232}
Las pruebas realizadas sobre el puerto serie RS232 pasó por tres fases.
\subsubsection{PLACA DE DESARROLLO CON PIC16F876}
Primero se probó la comunicación de la placa de desarrollo con PIC16F876 con el PC a traves del puerto COM. La aplicación utilizada para dichas pruebas fue SIOW.EXE\footnote{Herramienta software \ref{siow} página \pageref{siow}.}. Tanto la transmisión como la recepción de datos se llevó a cabo a 9600 baudios, que es la velocidad por defecto del GPS. Las tramas enviadas consistieron en texto plano para poder identificar los posibles errores visualmente.
\subsubsection{PLACA DE EXPANSIÓN DEL GPS}
La puesta en marcha del módulo GPS ha sido uno de los procesos más delicados del desarrollo del proyecto. Esto se ha debido a la dificultad para encontrar información al respecto, ya que en el manual del LASSEN LP GPS se habla constantemente de la placa base que suministra Trimble y de como hacer funcionar el GPS montado en su interior.\par
La prueba más relevante de esta placa ha sido conectar, a través de ella, el módulo GPS con el PC, utilizando la aplicación TSIPMonitor\footnote{Herramienta software \ref{tsipmon} página \pageref{tsipmon}.}. Obteniendo como resultado la lectura de las posiciones calculadas por el módulo GPS. Esta prueba confirma la compatibilidad de los conversores de nivel con la velocidad de la comunicación serie. Por otro lado el TSIPMonitor también nos informa de la presencia de la batería de salvaguarda y de los satélites utilizados para el cálculo de la posición.
\subsubsection{GPS CON PLACA DE DESARROLLO}
Una vez comprobadas la integración del módulo GPS con la placa de expansión y el correcto funcionamiento de la placa de desarrollo, el siguiente paso lógico es conectar la una a la otra y comprobar que se comunican sin problemas.\par
Para estas pruebas de comunicación se conectó el equipo GPS, con su antena incluida, a la placa de desarrollo, y ésta al PC a traves del ICD 2. La programación del microcontrolador solo capturaba y almacenaba en RAM la tramas enviadas por el GPS.\par
Gracias a este montaje se pudo analizar la configuración del GPS. La configuración del GPS no es trivial ya que puede trabajar de muchas maneras y se puede configurar casi toda la información que proporciona. De hecho, durante aquellas pruebas observamos que las tramas UTM, las que se utilizan actualmente, no eran enviadas y por tanto fue necesario reconfigurar el GPS.\par
La comunicación por puerto serie, tanto con niveles RS232 como con niveles TTL, fue un éxito.\\

\subsection{SISTEMA SENSORIAL}
Las pruebas realizadas sobre el sistema sensorial se centran en los sensores de movimiento.\par
Estos sensores tienen una capacidad de detección muy elevada, con la peculiaridad de que detectan mejor el movimiento de los objetos que se alejan que el de los que se acercan. El problema que surge de la alta sensibilidad es que detecta el movimiento del suelo respecto al sensor. Después de haber realizado varias pruebas, tanto en espacio cerrado como en espacio abierto, se concluyo que no solo era necesario poder ajustar la sensibilidad del receptor, cosa que permite el potenciómetro alojado en el módulo, sino que había que reducir la potencia de emisión para reducir el rango de detección. Para llevar a cabo tal propósito se colocó otro potenciómetro en serie con el emisor de ultrasonidos.\par
Mediante el ajuste de ambos potenciómetros se ha conseguido evitar la detección del movimiento sobre el suelo manteniendo el rango de detección y la sensibilidad necesarias para la aplicación.\\

\subsection{SISTEMA MOTRIZ}
Las pruebas realizadas sobre el sistema motriz no han sido en absoluto exahus\-ti\-vas. Simplemente se ha comprobado que las ruedas tienen tracción suficiente sobre el suelo, y que los motores tienen empuje suficiente para a\-rran\-car el movimiento y girar sin perder tracción ni potencia. Entre la pruebas realizadas se ha hecho subir al robot por una inclinación de más de 35º con resultados excelentes.\\

\section{\bfseries MONTAJE FINAL}\label{sec:pru2}
Las pruebas realizadas al robot completo han sido esenciales para depurar la programación. Estas pruebas se pueden agrupar en dos etapas. Una primera etapa de pruebas de evasión de obstáculos. Y una segunda etapa de pruebas de enrutamiento, que engloba tanto la evasión de obstáculos como el cálculo de la dirección y enrutamiento hacia el destino.

\subsection{EVASIÓN DE OBSTÁCULOS}
Las pruebas de evasión de obstáculos han consistido en resolver, por parte del robot, los distintos tipos de obstáculos planteados en el capítulo \ref{problema}. Todos han sido superados con éxito. Los obstáculos que han resultado más complicados de resolver para el robot son los escalones suficientemente altos para se insuperables por el robot, pero demasiado bajos para ser detectados por los sensores de movimiento. También existe la posibilidad de tropezar con una barra vertical suficientemente estrecha, a la cual se aproxime el robot directamente de frente, de forma que los sensores de movimiento también fallan. Queda patente por tanto la necesidad del sistema de detección de obstáculos por contacto, y de un sistema de detección a distancia mejorado.\\

\subsection{PRUEBAS DE ENRUTAMIENTO}
Las pruebas de enrutamiento han pasado por varias fases que han venido marcadas por los cambios realizados en el programa.\par
Inicialmente se programó al robot para buscar una posición diferencial de 10 metros Norte, 10 metros Este a partir de la posición inicial. El problema de este sistema de pruebas es, que no se conocía previamente el destino que debía alcanzar el robot con exactitud, no permitiendo optimizar el enrutamiento.\par
Posteriormente se programó el algoritmo de pruebas \ref{alg:MAIN}. Con este sistema de pruebas se detectaron varios problemas de enrutamiento. Cuando el giro realizado debido a una corrección de dirección dura alrededor de un segundo, llega la siguiente trama de posicionamiento calculada por el GPS, desencadenando una nueva maniobra de corrección de la dirección, pudiendo producir un cúmulo de correcciones sin llegar a avanzar. Por ese motivo se ha programado un criterio de descarte de tramas de posicionamiento demasiado proximas entre sí. Otro problema que quedó patente fue el error introducido por la función que controla la proximidad al punto destino. El robot en ningún momento interpretaba que habia llegado al destino, dando vueltas sobre el punto destino pero sin detenerse. Una vez corregido este error se empezaron a obtener resultados satisfactorios de enrutamiento.\par
Realizando pruebas con el programa definitivo apareció un nuevo problema. El robot iniciaba maniobras de evasión sin presencia de obstáculos. Esto se debía a un fallo de detección por parte de los sensores de movimiento, o\-ri\-gi\-na\-do por rafagas fuertes de viento. Se ha intentado corregir este error de detección reajustando los sensores, pero, en ocasiones, el robot esquiva obs\-ta\-cu\-los fantasma. De todos modos, estas maniobras de evasión innecesarias no repercuten en el correcto enrutamiento de robot ya que en ningún momento colisiona con obstáculos reales, y llega sin mayores problemas al destino prefijado. Esto se ha solucionado con rutinas software que compruban de nuevo la información recogida de los sensores después de detener el robot.\\